---
path: "/blog/docker-and-frontend"
date: "2021-01-21"
title: "Dockerä¸å‰ç«¯"
tags: ["Docker", "å‰ç«¯", "éƒ¨ç½²"]
weather: ğŸŒ§ï¸
---

> è½¬çœ¼åˆ°äº† 2021ï¼Œè‡ªå·±å¯¹äº 2020 è¿˜ä¸çŸ¥é“æ€ä¹ˆæ€»ç»“ï¼Œå´å‘ç°å¾ˆå¤šå¤§å‚éƒ½å·²ç»æ¨é€çš„å¹´åº¦æŠ€æœ¯æ€»ç»“ï¼Œå„ä¸ªå†…å®¹è¯¦å®ä¸”å…¨é¢ï¼Œä¸å¾—ä¸æ„Ÿæ…¨å¤§å…¬å¸çš„æŠ€æœ¯æ²‰æ·€ï¼Œç²—ç•¥çœ‹äº†çœ‹å‘ç°å¤§å®¶éƒ½æœ‰å…³æ³¨åˆ°å‰ç«¯çš„æ„å»ºä¸éƒ¨ç½²ï¼Œä»€ä¹ˆ serverless å‰ç«¯éƒ¨ç½²ã€äº‘æ„å»ºç­‰ï¼Œå¹¶ä¸”é‡Œé¢å¤§å¤šéƒ½ç”¨åˆ° docker è¿™ä¸€æŠ€æœ¯ã€‚è¿™è®©æˆ‘å¾ˆå¥½å¥‡ï¼Œdocker ä¸æ˜¯ç”¨ä½œè¿ç»´äº¤ä»˜çš„å—ï¼Œåœ¨å‰ç«¯é¢†åŸŸä½œç”¨ä»€ä¹ˆå‘¢ï¼Ÿå¸¦ç€è¿™ä»½å¥½å¥‡å¼€å§‹å­¦ä¹ äº† dockerï¼Œå¹¶å°è¯•æ€è€ƒ docker ä¹‹äºå‰ç«¯çš„æ„ä¹‰ã€‚

## ä»€ä¹ˆæ˜¯ Docker

Docker æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ã€å‘å¸ƒå’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¼€æ”¾å¹³å°ã€‚Docker æä¾›çš„`å®¹å™¨ï¼ˆcontainerï¼‰` èƒ½å¤Ÿå°†ä½ çš„åº”ç”¨ç¨‹åºä»ä½ çš„åŸºç¡€è®¾æ–½ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¿«é€Ÿåœ°äº¤ä»˜è½¯ä»¶ã€‚ä½¿ç”¨ Dockerï¼Œä½ å¯ä»¥åƒç®¡ç†åº”ç”¨ä¸€æ ·ç®¡ç†ä½ çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡åˆ©ç”¨ Docker çš„æ–¹æ³•æ¥å¿«é€Ÿåœ°å‘å¸ƒã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç ï¼Œä½ å¯ä»¥æ˜¾è‘—å‡å°‘ç¼–å†™ä»£ç å’Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œä»£ç ä¹‹é—´çš„å»¶è¿Ÿã€‚

## ç”¨ Docker æ¥åšä»€ä¹ˆ

- å¿«é€Ÿã€ä¸€è‡´åœ°äº¤ä»˜åº”ç”¨ç¨‹åº

- å“åº”å¼éƒ¨ç½²å’Œæ‰©å±•

- åœ¨åŒä¸€ç¡¬ä»¶ä¸Šè¿è¡Œæ›´å¤šçš„å·¥ä½œè´Ÿè½½

## Docker åŸºæœ¬æ¦‚å¿µ

Docker æ˜¯ä¸€ä¸ª C/S æ¶æ„çš„å¹³å°ï¼ŒDocker å®¢æˆ·ç«¯ä¸ Docker å®ˆæŠ¤ç¨‹åºï¼ˆ`deamon`ï¼‰è¿›è¡Œäº¤äº’ï¼Œè¯¥å®ˆæŠ¤ç¨‹åºä¸»è¦è´Ÿè´£æ„å»ºï¼Œè¿è¡Œå’Œåˆ†å‘ Docker å®¹å™¨ã€‚Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºå¯ä»¥åœ¨åŒä¸€ç³»ç»Ÿä¸Šè¿è¡Œï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥å°† Docker å®¢æˆ·ç«¯è¿æ¥åˆ°è¿œç¨‹ Docker å®ˆæŠ¤ç¨‹åºã€‚ Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºåœ¨ UNIX å¥—æ¥å­—æˆ–ç½‘ç»œæ¥å£ä¸Šä½¿ç”¨ REST API è¿›è¡Œé€šä¿¡ã€‚

![docker-architecture](https://docs.docker.com/engine/images/architecture.svg)

### Docker å®ˆæŠ¤è¿›ç¨‹(deamon)

Docker å®ˆæŠ¤è¿›ç¨‹(`dockerd`)ç›‘å¬ Docker API è¯·æ±‚ï¼Œå¹¶ç®¡ç† Docker å¯¹è±¡ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œå·ã€‚å®ˆæŠ¤è¿›ç¨‹ä¹Ÿå¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤è¿›ç¨‹é€šä¿¡æ¥ç®¡ç† Docker æœåŠ¡ã€‚

### Docker å®¢æˆ·ç«¯

Docker å®¢æˆ·ç«¯ï¼ˆ`docker`ï¼‰æ˜¯è®¸å¤š Docker ç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚ å½“ä½ ä½¿ç”¨è¯¸å¦‚ docker run ä¹‹ç±»çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€è‡³ dockerdï¼Œç„¶åæ‰§è¡Œå®ƒä»¬ã€‚ docker å‘½ä»¤ä½¿ç”¨ Docker APIã€‚ Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤ç¨‹åºé€šä¿¡ã€‚

### Docker registries

Docker çš„é•œåƒä»“åº“

Docker é•œåƒä»“åº“å­˜å‚¨ Docker é•œåƒã€‚Docker Hub æ˜¯ä¸€ä¸ªä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±æ³¨å†Œä¸­å¿ƒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker è¢«é…ç½®ä¸ºåœ¨ Docker Hub ä¸ŠæŸ¥æ‰¾é•œåƒã€‚ä½ ç”šè‡³å¯ä»¥è¿è¡Œè‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“ã€‚

### Docker å¯¹è±¡

å½“ä½ ä½¿ç”¨ Docker æ—¶ï¼Œä½ å°±ä¼šåˆ›å»ºå¹¶ä½¿ç”¨é•œåƒï¼ˆ`image`ï¼‰ã€å®¹å™¨ï¼ˆ`container`ï¼‰ã€ç½‘ç»œ(`network`)ã€å·(`volume`)ã€æ’ä»¶ï¼ˆ`plugin`ï¼‰å’Œå…¶ä»–å¯¹è±¡ã€‚è¿™é‡Œä¸»è¦ä»‹ç»åœ¨å®æ“ä¸­å‡ ä¸ªå…³é”®çš„å¯¹è±¡

#### é•œåƒ(`image`)

é•œåƒæ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼Œå¸¦æœ‰åˆ›å»º Docker å®¹å™¨çš„æŒ‡ä»¤ã€‚é€šå¸¸ï¼Œä¸€ä¸ªé•œåƒåŸºäºå¦ä¸€ä¸ªé•œåƒï¼Œå¹¶å¸¦æœ‰ä¸€äº›é¢å¤–çš„å®šåˆ¶ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ„å»ºä¸€ä¸ªåŸºäº ubuntu é•œåƒçš„é•œåƒï¼Œä½†è¦å®‰è£… Apache web æœåŠ¡å™¨å’Œä½ çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„é…ç½®ç»†èŠ‚ã€‚

ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä»…ä½¿ç”¨å…¶ä»–äººåœ¨`docker hub`ä¸Šå‘å¸ƒçš„é•œåƒã€‚ è¦æ„å»ºè‡ªå·±çš„é•œåƒï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å•çš„è¯­æ³•åˆ›å»ºä¸€ä¸ª `Dockerfile`ï¼Œä»¥å®šä¹‰åˆ›å»ºé•œåƒå¹¶è¿è¡Œå®ƒæ‰€éœ€çš„æ­¥éª¤ã€‚ `Dockerfile` ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåœ¨é•œåƒä¸­åˆ›å»ºä¸€ä¸ªå±‚ã€‚ å½“ä½ æ›´æ”¹ `Dockerfile` å¹¶é‡å»ºé•œåƒæ—¶ï¼Œ_ä»…é‡å»ºé‚£äº›å·²æ›´æ”¹çš„å±‚_ã€‚ ä¸å…¶ä»–è™šæ‹ŸåŒ–æŠ€æœ¯ç›¸æ¯”ï¼Œè¿™æ˜¯ä½¿é•œåƒå¦‚æ­¤è½»å·§ï¼Œå°å‹å’Œå¿«é€Ÿçš„éƒ¨åˆ†åŸå› ã€‚

#### å®¹å™¨(`container`)

å®¹å™¨æ˜¯ä¸€ä¸ª`é•œåƒ`è¿è¡Œåœ¨`docker engine`ä¸Šçš„å®ä¾‹(ä¸€ä¸ªè¿›ç¨‹)ã€‚ä½ å¯ä»¥ä½¿ç”¨ Docker API æˆ– CLI åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€ç§»åŠ¨æˆ–åˆ é™¤å®¹å™¨ã€‚ä½ å¯ä»¥å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œï¼Œä¸ºå…¶é™„åŠ å­˜å‚¨ï¼Œç”šè‡³æ ¹æ®å…¶å½“å‰çŠ¶æ€åˆ›å»ºä¸€ä¸ªæ–°é•œåƒã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¸å…¶ä»–å®¹å™¨åŠå…¶ä¸»æœºç›¸å¯¹éš”ç¦»ã€‚ä½ å¯ä»¥æ§åˆ¶å®¹å™¨çš„ç½‘ç»œã€å­˜å‚¨æˆ–å…¶ä»–åº•å±‚å­ç³»ç»Ÿä¸å…¶ä»–å®¹å™¨æˆ–ä¸»æœºä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ã€‚

å®¹å™¨æ˜¯ç”±å®ƒçš„é•œåƒä»¥åŠä½ æä¾›ç»™å®ƒçš„ä»»ä½•é…ç½®é€‰é¡¹å®šä¹‰çš„

> å®¹å™¨çš„è¿è¡Œæ¨¡å¼ vs VM çš„è¿è¡Œæ¨¡å¼
><div class="double-img" style="display:flex">
  <img src="https://www.docker.com/sites/default/files/d8/2018-11/docker-containerized-appliction-blue-border_2.png" style="width:50%" />
  <img src="https://www.docker.com/sites/default/files/d8/2018-11/container-vm-whatcontainer_2.png" style="width:50%" />
</div>  

#### å·(`volume`)

ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œ~~å®ƒä½¿ç”¨é•œåƒä¸­çš„å„ä¸ªå±‚ä½œä¸ºå…¶æ–‡ä»¶ç³»ç»Ÿ~~å®ƒä¼šä½¿ç”¨ç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿã€‚ æ¯ä¸ªå®¹å™¨è¿˜æ‹¥æœ‰è‡ªå·±çš„*æš‚å­˜ç©ºé—´*æ¥åˆ›å»º/æ›´æ–°/åˆ é™¤æ–‡ä»¶ã€‚

ä¸ºäº†èƒ½å¤Ÿä¿è¯å®¹å™¨ä¸­çš„æ•°æ®èƒ½å¤ŸæŒä¹…åŒ–ï¼Œdocker æä¾›äº†`å·`,`å·`æ˜¯ docker åœ¨ä¸»æœºå­˜å‚¨ç©ºé—´ä¸­åˆ›å»ºçš„ä¸€ä¸ªç›®å½•ï¼ŒDocker ä¼šç®¡ç†è¿™ä¸ªç›®å½•çš„å†…å®¹ï¼Œå®ƒæœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`å·`è®©ä¸»æœºä¸å®¹å™¨åŠå®¹å™¨ä¸å®¹å™¨ä¹‹é—´å…±äº«å¹¶æŒä¹…åŒ–æ•°æ®ã€‚

![docker-volume-share](https://docs.docker.com/storage/images/volumes-shared-storage.svg)
![docker-volume](https://steve911.oss-cn-shanghai.aliyuncs.com/image/docker-volume.png)

> åœ¨ docker æ—©æœŸï¼Œä¸€èˆ¬æ˜¯é€šè¿‡`bind mounts`æ¥å…±äº«ä¸»æœºä¸å®¹å™¨å†…çš„æ•°æ®ï¼Œè¿™ç§æ–¹å¼èƒ½è¡¨ç°å‡ºæ›´é«˜çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒç›´æ¥é‡‡ç”¨ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¾ˆé€‚åˆç”¨äºå¼€å‘ã€‚
> ![types-of-mounts-bind](https://docs.docker.com/storage/images/types-of-mounts-bind.png)

## ä½¿ç”¨ Docker çš„å…³é”®æ­¥éª¤

### Installation & Tooling

[è§å®˜ç½‘](https://docs.docker.com/get-docker/)

### Build an Image

- åˆ›å»º Dockerfile,å…¶å†³å®šå¦‚ä½•æ„å»ºé•œåƒ
- æ‰§è¡Œ docker build

  ```sh
  docker build -t 911/docker-test:1.0 .
  ```

### Run a Container

```sh
docker run -p 3000:3000 911/docker-test:1.0
```

- `-p 3000:3000`å°†ä¸»æœºçš„ 3000 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…çš„ 3000 ç«¯å£

### Debugging

é€šè¿‡ `inspect` å¯ä»¥ç›´æ¥è¿›å…¥å®¹å™¨è¿›è¡Œè°ƒè¯•æ“ä½œ

### Docker Compose

- åˆ›å»º docker-compose.yml,å…¶å†³å®šå¦‚ä½•ç¼–æ’å¤šå®¹å™¨ç»„åˆè¿è¡Œ
- æ‰§è¡Œ docker-compose up

  ```sh
   docker-compose up
  ```

## Docker åœ¨å‰ç«¯çš„ä½¿ç”¨

æ ¹æ® Docker çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å…¶ä½œä¸ºæœåŠ¡ç«¯éƒ¨ç½²æ˜¯ç»ä½³çš„åº”ç”¨åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‰ç«¯èƒ½å¤Ÿç”¨åˆ°å®ƒå—ï¼Ÿ

å®é™…ä¸Šæ˜¯æœ‰çš„ï¼Œå¦‚ä»Šå‰ç«¯é¡¹ç›®éƒ½é«˜åº¦å·¥ç¨‹åŒ–ï¼Œé¡µé¢äº§ç‰©çš„æ„å»ºæ‰€ä¾èµ–çš„å‰ç½®ç¯å¢ƒè¶Šæ¥è¶Šå¤šï¼Œè¿™å°±ä¼šå¯¼è‡´å¼€å‘å‡†å¤‡æˆæœ¬çš„å¢åŠ ã€æ„å»ºäº§ç‰©ä¸ç¨³å®šæ€§çš„å¢åŠ ã€‚é‚£ä¹ˆè¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Docker åˆ›å»ºä¸€ä¸ªé›†æˆå‰ç«¯å¼€å‘åŠæ„å»ºç¯å¢ƒçš„é•œåƒï¼Œä¹‹åçš„å¼€å‘ä¸æ„å»ºéƒ½åœ¨æ­¤é•œåƒçš„å®¹å™¨ä¸­è¿›è¡Œã€‚

### ç»Ÿä¸€ç¯å¢ƒå¼€å‘

å°†ä¸šåŠ¡ä»£ç ä½œä¸º`volume`ï¼Œä½¿è¿è¡Œåœ¨å®¹å™¨å†…çš„å‰ç«¯åº”ç”¨æ ¹æ®ä¸»æœºçš„ä¸šåŠ¡ä»£ç è¿›è¡Œç¼–è¯‘è¿è¡ŒåŠç›‘å¬ï¼Œä¿è¯å¼€å‘æ—¶çš„çƒ­åŠ è½½ï¼Œå®Œç¾æ›¿æ¢è¿‡å»çš„å¼€å‘æ¨¡å¼ã€‚

è¿™é‡Œä½¿ç”¨ä»¥ vite æ„å»ºï¼ˆ`npm init vite-app vite-docker`ï¼‰çš„ vue3 ä¸ºæ¨¡æ¿é¡¹ç›®

ç„¶åæˆ‘ä»¬`cd vite-docker`è¿›å…¥é¡¹ç›®æ–‡ä»¶ï¼Œæé€Ÿæ­å»ºä¸€ä¸ª docker å®¹å™¨çš„å¼€å‘ç¯å¢ƒ

- step1:åˆ›å»º`Dockerfile`

  ```Dockerfile
  FROM node:12

  WORKDIR /app

  COPY package*.json ./

  RUN npm install

  COPY . .
  ```

- step2:æ„å»ºé•œåƒ

  ```sh
  docker build -t scout911/vite-vue:1.0 .
  ```

  è¿™é‡Œæ„å»ºäº†ä¸€ä¸ªåä¸º scout911/vite-vue:1.0 çš„é•œåƒ

- step3:ç”Ÿæˆå¼€å‘ç¯å¢ƒçš„å®¹å™¨

  ```sh
  # linux
  docker run -v $(pwd)/src:/app/src  -p 3000:3000  scout911/vite-vue:1.0  npm run dev
  ```

  è¿™é‡Œæˆ‘ä»¬é€šè¿‡`-v $(pwd)/src:/app/src`å°†æœ¬åœ°ä¸»æœºçš„/\$(pwd)/src æŒ‚è½½åˆ°å®¹å™¨å†…çš„ src ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ç›´æ¥ä¿®æ”¹æœ¬åœ°çš„æ–‡ä»¶æ¥è¿›è¡Œè°ƒè¯•å¼€å‘

### ç»Ÿä¸€ç¯å¢ƒéƒ¨ç½²

å°†å‰ç«¯åº”ç”¨æ„å»ºåœ¨ä¸å¼€å‘ä¸€è‡´çš„`å®¹å™¨`ç¯å¢ƒä¸­ï¼Œç¡®ä¿äº†å¼€å‘ä¸ç”Ÿäº§çš„ä¸€è‡´æ€§ï¼Œä¹Ÿä¿è¯çš„æ„å»ºè¾“å‡ºçš„å”¯ä¸€æ€§ã€‚

åœ¨ç°ä»Šå‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å‰ç«¯çš„é¡¹ç›®éƒ½æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š

- é€šè¿‡é™æ€ä»£ç†åœ¨å®¿ä¸»æœºï¼ˆä¾‹å…¥ NGNIXï¼‰
- å°†å‰ç«¯æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨æœåŠ¡(ä¾‹å¦‚é˜¿é‡Œçš„ OSS,è…¾è®¯çš„ COS)

è¿™ä¸¤ç§æ–¹å¼çš„åŒºåˆ«åœ¨äºå¯¹æ„å»ºäº§ç‰©çš„å¤„ç†æ–¹å¼ã€‚æ— è®ºä½•ç§æ–¹å¼éƒ½å¯ä»¥ç»“åˆä»¥`docker`å®¹å™¨ä¸ºè¿è¡Œç¯å¢ƒçš„æ„å»ºæ‰“åŒ…ã€‚

## å‚è€ƒ

- [https://docs.docker.com/get-started/overview/](https://docs.docker.com/get-started/overview/)
- The Complete Works of Tao Technology
- [serverless åœ¨å‰ç«¯éƒ¨ç½²é¢†åŸŸçš„å®è·µ](https://www.yuque.com/office/yuque/0/2020/pdf/333434/1608622060089-7f994590-83e8-4cdd-a90a-931eb6769065.pdf?from=https%3A%2F%2Fwww.yuque.com%2Fd2forum%2Fcontent%2Fbxb7n5)
